!function(e){var t={};function a(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)a.d(r,s,function(t){return e[t]}.bind(null,s));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=2)}([function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var r=function(){function e(){}return e.padStart=function(e,t,a){if(void 0===a&&(a=" "),""===a)return e;for(var r="";r.length+e.length<t;)r+=a;return r.substring(0,t-e.length)+e},e.padEnd=function(e,t,a){if(void 0===a&&(a=" "),""===a)return e;for(var r="";r.length+e.length<t;)r+=a;return e+r.substring(0,t-e.length)},e.replaceNoFilename=function(e){return e.replace(/\\/g,"￥").replace(/\//g,"／").replace(/\:/g,"：").replace(/\*/g,"＊").replace(/\?/g,"？").replace(/\"/g,"”").replace(/\</g,"＜").replace(/\>/g,"＞").replace(/\|/g,"｜")},e}()},function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var r=function(){function e(){}return e.getParam=function(){for(var e={},t=0,a=location.search.substring(1).split("&");t<a.length;t++){var r=a[t],s=r.search(/=/);if(-1!==s){var i=decodeURI(r.slice(0,s)),n=decodeURI(r.slice(s+1));if(-1!==i.search(/\[\]$/)){var o=i.substring(0,i.length-2),l=e[o];l instanceof Array?l.push(n):e[o]=[n]}else e[i]=n}}return e},e.get=function(e,t,a,r){var s=new XMLHttpRequest;s.open("get",e,!0),a&&s.addEventListener("load",(function(e){s.status>=200&&s.status<300?a(s.responseText):r&&r()})),r&&s.addEventListener("error",(function(e){r()})),s.send(t)},e}()},function(e,t,a){"use strict";a.r(t);var r,s=a(1),i=function(){function e(){this.title="",this.difficult="",this.level=0,this.noteList=[],this.barList=[],this.bpmList=[],this.scrollList=[],this.feverList=[],this.maxCombo=0,this.time=0,this.laneCount=e.LANE_COUNT,this.sound="",this.soundVolume=100,this.soundOffset=0}return e.LANE_COUNT=5,e.DIFFICULT_MAP={1:"Easy",e:"Easy",easy:"Easy",2:"Normal",n:"Normal",normal:"Normal",3:"Hard",h:"Hard",hard:"Hard",4:"Expert",ex:"Expert",expert:"Expert"},e}();!function(e){e.NORMAL="1",e.SLIDE_UP="2",e.SLIDE_LEFT="3",e.SLIDE_RIGHT="4",e.LONG1_START="5",e.LONG1_END_NORMAL="6",e.LONG1_END_SLIDE_UP="7",e.LONG1_END_SLIDE_LEFT="8",e.LONG1_END_SLIDE_RIGHT="9",e.LONG2_START="a",e.LONG2_END_NORMAL="b",e.LONG2_END_SLIDE_UP="c",e.LONG2_END_SLIDE_LEFT="d",e.LONG2_END_SLIDE_RIGHT="e"}(r||(r={}));var n=function(){function e(){this.type=r.NORMAL,this.laneIdx=0,this.barIdx=0,this.beat=0,this.beatSum=0,this.time=0,this.bpm=0,this.scroll=0,this.barValueM=0,this.barValueD=0,this.next=null,this.prev=null}return e.prototype.getAddCombo=function(){return 1},e.prototype.createNoteElement=function(e,t,a,s,i){void 0===i&&(i=!1);var n=document.createElement("div"),o=null,l=null,c=(e+1)*(this.laneIdx+.5)-(a+1)/2,h=this.beat*t-(s+1)/2,u=1+Math.sqrt(5),d=a/2,p=a,b=d-u/2,m=p-u,f=this.next,L=null!==f?(e+1)*(f.laneIdx+.5):0,E=null!==f?L-(a+1)/2:0;switch(h=i&&null!==f?-(f.beatSum-f.beat-this.beatSum)*t:h,this.type){case r.NORMAL:return n.className="note1",n.style.width=a+"px",n.style.height=s+"px",n.style.left=c+"px",n.style.bottom=h+"px",(l=document.createElement("div")).style.bottom=(s-3)/2+"px",l.className="note1-sub",n.appendChild(l),n;case r.SLIDE_UP:case r.LONG1_END_SLIDE_UP:case r.LONG2_END_SLIDE_UP:return n.className="note2",n.style.width=a+"px",n.style.height=a+"px",n.style.left=c+"px",n.style.bottom=this.beat*t-(a-1)/2+"px",n.style.borderWidth="0px "+d+"px "+p+"px "+d+"px",(l=document.createElement("div")).className="note2-sub",l.style.bottom="-"+(a-1)+"px",l.style.borderWidth="0px "+b+"px "+m+"px "+b+"px",n.appendChild(l),n;case r.SLIDE_LEFT:case r.SLIDE_RIGHT:case r.LONG1_END_SLIDE_LEFT:case r.LONG1_END_SLIDE_RIGHT:case r.LONG2_END_SLIDE_LEFT:case r.LONG2_END_SLIDE_RIGHT:var N=this.type===r.SLIDE_LEFT||this.type===r.LONG1_END_SLIDE_LEFT||this.type===r.LONG2_END_SLIDE_LEFT;n.className=N?"note3":"note4",n.style.bottom=this.beat*t-(a-1)/2-1+"px",N?(n.style.left=c-e+"px",n.style.borderWidth=d+"px "+p+"px "+d+"px "+p+"px"):(n.style.left=c+"px",n.style.borderWidth=d+"px 0px "+d+"px "+p+"px"),(l=document.createElement("div")).className=N?"note3-sub1":"note4-sub1",N?(l.style.right="-"+(a-1)+"px",l.style.borderWidth=b+"px "+m+"px "+b+"px 0px"):(l.style.left="-"+(a-1)+"px",l.style.borderWidth=b+"px 0px "+b+"px "+m+"px");var v=document.createElement("div");return v.className=N?"note3-sub2":"note4-sub2",v.style.width=a-u-1+"px",N?v.style.right="-"+(a-1)+"px":v.style.left="-"+(a-1)+"px",n.appendChild(l),n.appendChild(v),n;case r.LONG1_START:case r.LONG2_START:if(null===f)return document.createElement("div");n.className="note5",n.style.left=c+"px",n.style.bottom=h+"px",n.style.width=a+"px",n.style.height=s+"px",(o=document.createElement("div")).className="note5-main",o.style.width=a+"px",o.style.height=s+"px",o.style.left="0",o.style.bottom="0",(l=document.createElement("div")).className="note5-sub",l.style.bottom=(s-3)/2+"px";var _=document.createElement("div"),x=document.createElement("div");_.className="note5-long-box",x.className="note5-long";var I=c-E,g=(f.beatSum-this.beatSum)*t,y=Math.sqrt(Math.pow(I,2)+Math.pow(g,2)),D=Math.abs(I)+a,T=f.type===r.LONG1_START||f.type===r.LONG2_START||f.type===r.LONG1_END_NORMAL||f.type===r.LONG2_END_NORMAL?g-s:g-s/2;_.style.width=D+"px",_.style.height=T+"px",_.style.bottom=s+"px";var O=90-180*Math.atan(T/Math.abs(I))/Math.PI;return x.style.width=a*Math.sin((90-Math.abs(O))/180*Math.PI)+"px",x.style.height=y+10+"px",I>0?(_.style.right="0",x.style.right="0",x.style.transform="rotate("+-1*O+"deg)",x.style.transformOrigin="bottom right"):(_.style.left="0",x.style.left="0",x.style.transform="rotate("+O+"deg)",x.style.transformOrigin="bottom left"),o.appendChild(l),n.appendChild(o),_.appendChild(x),n.appendChild(_),n;case r.LONG1_END_NORMAL:case r.LONG2_END_NORMAL:return n.className="note6",n.style.width=a+"px",n.style.height=s+"px",n.style.left=c+"px",n.style.bottom=h+"px",(l=document.createElement("div")).className="note6-sub",l.style.bottom=(s-3)/2+"px",n.appendChild(l),n;default:throw new Error("未実装のノート : "+this.type)}},e.VALID_TYPE=/^[1-9a-e]$/,e.NOTE_RELATION=function(){var e={},t=[];t.push(r.LONG1_START),t.push(r.LONG1_END_NORMAL),t.push(r.LONG1_END_SLIDE_UP),t.push(r.LONG1_END_SLIDE_LEFT),t.push(r.LONG1_END_SLIDE_RIGHT),e[r.LONG1_START]=t;var a=[];return a.push(r.LONG2_START),a.push(r.LONG2_END_NORMAL),a.push(r.LONG2_END_SLIDE_UP),a.push(r.LONG2_END_SLIDE_LEFT),a.push(r.LONG2_END_SLIDE_RIGHT),e[r.LONG2_START]=a,e}(),e}(),o=function(e,t,a,r){this.valueM=0,this.valueD=0,this.barIdx=0,this.time=0,this.valueM=e,this.valueD=t,this.barIdx=a,this.time=r},l=function(e,t,a,r){this.value=0,this.barIdx=0,this.beat=0,this.time=0,this.value=e,this.barIdx=t,this.beat=a,this.time=r},c=function(e,t,a,r){this.value=0,this.barIdx=0,this.beat=0,this.time=0,this.value=e,this.barIdx=t,this.beat=a,this.time=r},h=a(0),u=function(){this.startBarIdx=0,this.startBeat=0,this.startTime=0,this.endBarIdx=999999,this.endBeat=0,this.endTime=0},d=function(){function e(){}return e.load=function(e){var t=this;this.score=new i,this.barIdx=0,this.barValueM=4,this.barValueD=4,this.barTime=0,this.bpmValue=120,this.scrollValue=1,this.beat=0,this.beatSum=0,this.beatAdd=0,this.time=0,this.fever=null;var a=e.split(/\r\n|\r|\n/g);if((a=this.normalize(a)).forEach((function(e,r){"#"===e.charAt(0)?t.parseOrderLine(e):(0===t.beatAdd&&(t.beatAdd=t.getBeatAdd(a,r),t.barTime=t.time),t.parseOtherLine(e))})),this.score.time=this.time,this.score.maxCombo=this.getMaxCombo(),this.setNoteRelation(),0===this.score.bpmList.length){var r=new l(this.bpmValue,0,0,0);this.score.bpmList.push(r)}if(0===this.score.scrollList.length){var s=new c(this.scrollValue,0,0,0);this.score.scrollList.push(s)}return console.info(this.score),this.score},e.normalize=function(e){h.a.padStart("",this.score.laneCount,"0");for(var t=0,a=0;t<e.length;){var r=e[t],s=r.indexOf("//");if(-1!==s&&(r=r.substring(0,s)),"#"!==r.charAt(0)&&(r=r.replace(/[^a-zA-Z0-9,]/g,"")),0!==r.length){if("#"!==r.charAt(0)){if(","===r.charAt(0))1!==r.length&&(e.splice(t+1,0,r.substr(1)),r=",");else{var i=r.substr(1).indexOf(",")+1;0!==i&&(e.splice(t+1,0,r.substr(i)),r=r.substring(0,i)),r.length>this.score.laneCount&&(e.splice(t+1,0,r.substr(this.score.laneCount)),r=r.substring(0,this.score.laneCount)),r.length<this.score.laneCount&&(r=h.a.padEnd(r,this.score.laneCount,"0"))}","===r.charAt(0)?0===a?(e.splice(t+1,0,","),r="00000",a++):a=0:a++}e[t]=r,t++}else e.splice(t,1)}return 0!==a&&e.push(","),e},e.parseOrderLine=function(e){var t,a,r,s,n=this.getOrderName(e),o=this.getOrderValue(e);switch(n){case"#title":this.score.title=o;break;case"#bpm":if(s=parseFloat(o),isNaN(s)){console.warn("無効値のBPM : "+o+" "+this.getParseLocation());break}if(s<=0){console.warn("無効値のBPM : "+s+" "+this.getParseLocation());break}if(0!==this.score.bpmList.length){var h=this.score.bpmList[this.score.bpmList.length-1];if(h.barIdx===this.barIdx&&h.beat===this.beat&&this.score.bpmList.pop(),h.value===s)break}var d=new l(s,this.beat,this.barIdx,this.time);this.score.bpmList.push(d),this.bpmValue=s;break;case"#scroll":if(s=parseFloat(o),isNaN(s)){console.warn("無効値のSCROLL : "+o+" "+this.getParseLocation());break}if(0!==this.score.scrollList.length){var p=this.score.scrollList[this.score.scrollList.length-1];if(p.barIdx===this.barIdx&&p.beat===this.beat&&this.score.scrollList.pop(),p.value===s)break}var b=new c(s,this.beat,this.barIdx,this.time);this.score.scrollList.push(b),this.scrollValue=s;break;case"#difficult":if(void 0===i.DIFFICULT_MAP[o.toLowerCase()]){console.warn("無効値の難易度 : "+o+" "+this.getParseLocation());break}this.score.difficult=i.DIFFICULT_MAP[o.toLowerCase()];break;case"#level":if(a=parseInt(o),isNaN(a)){console.warn("無効値のレベル : "+o+" "+this.getParseLocation());break}this.score.level=parseInt(o);break;case"#measure":if(t=this.getSplitOrderValue(o,"/"),0!==this.beat){console.warn("無効値な位置に定義されたMEASURE : "+o+" "+this.getParseLocation());break}if(null===t){console.warn("無効値のMEASURE : "+o+" "+this.getParseLocation());break}if(a=parseInt(t[0]),r=parseInt(t[1]),isNaN(a)||isNaN(r)){console.warn("無効値のMEASURE : "+t[0]+" / "+t[1]+" "+this.getParseLocation());break}if(a<=0||r<=0){console.warn("無効値のMEASURE : "+a+" / "+r+" "+this.getParseLocation());break}this.barValueM=a,this.barValueD=r;break;case"#sound":this.score.sound=o;break;case"#soundvolume":if(s=parseFloat(o),isNaN(s)){console.warn("無効値のSOUNDVOLUME (0 ～ 100) : "+o+" "+this.getParseLocation());break}if(s<0||s>100){console.warn("無効値のSOUNDVOLUME (0 ～ 100) : "+s+" "+this.getParseLocation());break}this.score.soundVolume=s;break;case"#offset":if(s=parseFloat(o),isNaN(s)){console.warn("無効値のOFFSET : "+o+" "+this.getParseLocation());break}this.score.soundOffset=s;break;case"#feverstart":if(null!==this.fever){console.warn("重複しているFEVERSTART : "+o+" "+this.getParseLocation());break}var m=new u;m.startBarIdx=this.barIdx,m.startBeat=this.beat,m.startTime=this.time,this.score.feverList.push(m),this.fever=m;break;case"#feverend":if(null===this.fever){console.warn("対応するFEVERSTARTなし : "+o+" "+this.getParseLocation());break}this.fever.endBarIdx=this.barIdx,this.fever.endBeat=this.beat,this.fever.endTime=this.time,this.fever=null;break;default:console.warn("無効な命令 : "+n+" "+this.getParseLocation())}},e.parseOtherLine=function(e){var t=this;if(","===e.charAt(0)){var a=new o(this.barValueM,this.barValueD,this.barIdx,this.barTime);return this.score.barList.push(a),this.beat=0,this.beatAdd=0,void this.barIdx++}Array.prototype.forEach.call(e,(function(e,a){if("0"!==e){if(-1===e.search(n.VALID_TYPE))return void console.warn("無効なノート : "+e+" "+t.getParseLocation());var r=new n;r.type=e,r.barIdx=t.barIdx,r.beat=t.beat,r.beatSum=t.beatSum,r.laneIdx=a,r.time=t.time,r.bpm=t.bpmValue,r.scroll=t.scrollValue,r.barValueM=t.barValueM,r.barValueD=t.barValueD,t.score.noteList.push(r)}})),this.beat+=this.beatAdd,this.beatSum+=this.beatAdd,this.time+=6e4/this.bpmValue*(this.barValueM/this.barValueD)*this.beatAdd},e.getOrderName=function(e){var t=e.indexOf(":");return-1!==t?e.substring(0,t).trim().toLowerCase():e.trim().toLowerCase()},e.getOrderValue=function(e){var t=e.indexOf(":");return-1!==t?e.substr(t+1).trim():""},e.getSplitOrderValue=function(e,t){void 0===t&&(t="/");var a=e.indexOf(t);return-1!==a?[e.substring(0,a),e.substring(a+1)]:null},e.getBeatAdd=function(e,t){for(var a=0,r=t;r<e.length;r++){var s=e[r];if(","===s.charAt(0))break;"#"!==s.charAt(0)&&a++}return this.barValueM/this.barValueD*4/a},e.getMaxCombo=function(){var e=0;return this.score.noteList.forEach((function(t){e+=t.getAddCombo()})),e},e.setNoteRelation=function(){var e=this;this.score.noteList.forEach((function(t,a){var r=n.NOTE_RELATION[t.type];if(void 0!==r)for(var s=a+1;;s++){if(s>=e.score.noteList.length){console.warn("関連するノートなし : "+t.type+" (小節数 : "+(t.barIdx+1)+" 拍数 : "+t.beat+")");break}var i=e.score.noteList[s];if(-1!==r.indexOf(i.type)){t.next=i,i.prev=t;break}}}))},e.getParseLocation=function(){return"(小節数 : "+(this.barIdx+1)+" 拍数 : "+this.beat+")"},e.score=new i,e.barIdx=0,e.barValueM=0,e.barValueD=0,e.barTime=0,e.bpmValue=0,e.scrollValue=0,e.beat=0,e.beatSum=0,e.beatAdd=0,e.time=0,e.fever=null,e}();(function(){function e(){}return e.init=function(){var t=this;window.addEventListener("DOMContentLoaded",(function(){e.param=s.a.getParam(),e.param.load?s.a.get(encodeURI(e.param.load),null,(function(e){t.score=d.load(e),t.setScoreInfo(),t.draw()}),t.showErrorInfo):t.showErrorInfo()}))},e.showErrorInfo=function(){var t=document.getElementById("error-info");e.param&&e.param.load?t.textContent="読み込みに失敗しました : "+e.param.load:t.textContent="読み込みに失敗しました"},e.setScoreInfo=function(){document.title=this.score.title+" "+this.score.difficult+" | SHOW BY ROCK!! Fes A Live Score Viewer",document.getElementById("title").textContent=""+this.score.title,document.getElementById("difficult").textContent=""+this.score.difficult,document.getElementById("info-level").textContent=""+this.score.level,document.getElementById("info-bpm").textContent=""+this.getBpmText(),document.getElementById("info-combo").textContent=""+this.score.maxCombo,document.getElementById("info-time").textContent=""+Math.ceil(this.score.time/1e3)},e.draw=function(){var t,a=document.createElement("table"),r=document.createElement("tr"),s=this.createBarNoteMap(),n=0;for(a.className="col-table";n<this.score.barList.length;){var o=document.createElement("td"),l=document.createElement("table");l.className="row-table",l.style.width=20+(e.DRAW_LANE_WIDTH+1)*i.LANE_COUNT+1+"px";var c=n,h=0;do{var u=n<this.score.barList.length?this.score.barList[n]:this.score.barList[this.score.barList.length-1],d=u.valueM/u.valueD*4,p=document.createElement("tr"),b=document.createElement("th"),m=document.createElement("td"),f=document.createElement("div");f.className="draw-area",m.style.height=e.DRAW_BEAT_HEIGHT*d+"px",b.textContent=""+(n+1),f.appendChild(this.createDrawInfoArea(n,d)),n<this.score.barList.length&&f.appendChild(this.createDrawNoteArea(s[n],c)),h+=u.valueM/u.valueD*4,n++,m.appendChild(f),p.appendChild(b),p.appendChild(m),l.insertBefore(p,l.firstChild)}while(h<e.DRAW_COL_BEAT);o.appendChild(l),r.appendChild(o)}a.appendChild(r),null===(t=document.getElementById("score-board"))||void 0===t||t.appendChild(a),document.querySelector("header").style.display="block",document.querySelector("main").style.display="inline-block"},e.getBpmText=function(){if(1===this.score.bpmList.length)return""+this.score.bpmList[0].value;var e=this.score.bpmList.map((function(e){return e.value}));return Math.min.apply(null,e)+" - "+Math.max.apply(null,e)},e.createDrawInfoArea=function(t,a){var r=document.createElement("div");r.className="draw-info-area";for(var s=0,n=this.score.feverList;s<n.length;s++){var o=n[s];if(t>=o.startBarIdx&&t<=o.endBarIdx){var l=document.createElement("div");l.className="fever-bg";var c=t===o.startBarIdx?o.startBeat*e.DRAW_BEAT_HEIGHT+"px":0,h=void 0;h=t===o.startBarIdx?(a-o.startBeat)*e.DRAW_BEAT_HEIGHT-1+"px":t===o.endBarIdx?o.endBeat*e.DRAW_BEAT_HEIGHT+"px":"100%",l.style.bottom=""+c,l.style.height=""+h,r.appendChild(l)}}for(var u=1;u<i.LANE_COUNT;u++){var d=document.createElement("div");d.className="lane-line",d.style.left=(e.DRAW_LANE_WIDTH+1)*u-1+"px",r.appendChild(d)}for(var p=1;p<a;p++){var b=document.createElement("div");b.className="beat-line1",b.style.bottom=e.DRAW_BEAT_HEIGHT*p-1+"px",r.appendChild(b)}for(p=.5;p<a;p++){var m=document.createElement("div");m.className="beat-line2",m.style.bottom=e.DRAW_BEAT_HEIGHT*p-1+"px",r.appendChild(m)}return r},e.createDrawNoteArea=function(t,a){var r=document.createElement("div");r.className="draw-note-area";for(var s=0,i=t;s<i.length;s++){var n=i[s],o=e.DRAW_LANE_WIDTH,l=e.DRAW_BEAT_HEIGHT,c=e.DRAW_NOTE_WIDTH,h=e.DRAW_NOTE_HEIGHT,u=n.createNoteElement(o,l,c,h);if(r.appendChild(u),null!==n.prev&&n.prev.barIdx<a){var d=n.prev.createNoteElement(o,l,c,h,!0);r.appendChild(d)}}return r},e.createBarNoteMap=function(){var e={};return this.score.barList.forEach((function(t,a){e[a]=[]})),this.score.noteList.forEach((function(t){e[t.barIdx].push(t)})),e},e.DRAW_BEAT_HEIGHT=25,e.DRAW_LANE_WIDTH=11,e.DRAW_NOTE_WIDTH=11,e.DRAW_NOTE_HEIGHT=5,e.DRAW_COL_BEAT=24,e.param=null,e})().init()}]);