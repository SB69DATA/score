function init(){document.getElementById("stage-score").checked=!0,document.getElementById("fiver-high").checked=!1,document.getElementById("attack-long").checked=!1,document.getElementById("defense-short").checked=!1,document.getElementById("measure-offset").value="2.5秒"}function changeFiverRate(e){SBRSScore.option.fiverHighRate=e,drawScore(sbrs)}function changeBossSkill(){SBRSScore.option.attackLong=document.getElementById("attack-long").checked,SBRSScore.option.defenseShort=document.getElementById("defense-short").checked,drawScore(sbrs)}function countMeasureOffset(e){var t=document.getElementById("measure-offset"),o=Math.round(10*(Number(t.value.slice(0,-1))+e))/10;0>o||o>5||(t.value=(1==String(o).length?o+".0":o)+"秒",SBRSScore.option.measureOffset=o,drawScore(sbrs))}function checkAttackPlayer(e,t){if("score"!==SBRSScore.option.stage){for(var o=0;o<e.length;o++)if(t>=e[o].fromTime&&t<=e[o].toTime)return!1;return!0}}function changeStage(e){var t=null,o="",r="",n="";"score"===e?(r="inline-block",o="none",scoreThStyle="table-row",n="none",SBRSScore.option.stage="score"):(r="none",o="inline-block",scoreThStyle="none",n="table-row",SBRSScore.option.stage="boss"),t=document.getElementsByClassName("stage-score-th");for(var i=0;i<t.length;i++)t[i].style.display=scoreThStyle;t=document.getElementsByClassName("stage-boss-th");for(var i=0;i<t.length;i++)t[i].style.display=n;t=document.getElementsByClassName("stage-score");for(var i=0;i<t.length;i++)t[i].style.display=r;t=document.getElementsByClassName("stage-boss");for(var i=0;i<t.length;i++)t[i].style.display=o;drawScore(sbrs)}function drawScore(e){try{var t=document.getElementById("score_board");t.innerHTML="";var o=t.insertRow(0),r="";r+='<div class="line3" style="bottom:15px;  z-index:5;"></div>',r+='<div class="line3" style="bottom:47px;  z-index:5;"></div>',r+='<div class="line3" style="bottom:79px;  z-index:5;"></div>',r+='<div class="line3" style="bottom:111px; z-index:5;"></div>',r+='<div class="line2" style="bottom:31px;  z-index:5;"></div>',r+='<div class="line2" style="bottom:63px;  z-index:5;"></div>',r+='<div class="line2" style="bottom:95px;  z-index:5;"></div>',r+='<div class="line1" style="left:15px;    z-index:5;"></div>',r+='<div class="line1" style="left:31px;    z-index:5;"></div>',r+='<div class="line0" style="bottom:-1px;  z-index:5;"></div>';for(var n=function(){for(var t=new Array,o=0,r=0;r<e.markerCount;r++){var n=e.marker[r].type;switch(n){case 1:t[o++]=e.marker[r].time;break;case 2:t[o++]=e.marker[r].time;for(var i=0;i<e.marker[r]["long"].longCount;i++)t[o++]=e.marker[r]["long"].marker[i].time;t[o++]=e.marker[r]["long"].time}}return t.sort(function(e,t){return e-t}),t}(),i=function(){function t(e,t,o,r,n,i,a){this.type=e,this.fromMeasure=t,this.fromPoint=o,this.fromTime=r,this.toMeasure=n,this.toPoint=i,this.toTime=a}var o,r,i,a,s=new Array,l=0;if("score"===SBRSScore.option.stage){var c=0,d=0,m=0,v=SBRSScore.option.fiverHighRate?e.fiverHigh:e.fiver;for(var u in n){var p=n[u];if(d>p)m++;else if(c++,c>=v){var h=SBRS.getMeasurePointObject(e,p),g=SBRS.getMeasurePointObject(e,p+1e4),o=h.measure,r=h.point,f=p,i=g.measure,a=g.point,S=p+1e4;s[l++]=new t("fiver",o,r,f,i,a,S),c=0,d=SBRS.roundTime(p+1e4)}}document.getElementsByClassName("value")[2].innerHTML=m}else{var y=10,x=8.5;for(SBRSScore.option.attackLong&&(y=22),SBRSScore.option.defenseShort&&(x=7),u=y-SBRSScore.option.measureOffset;300>u;u+=y+x){var h=SBRS.getMeasurePointObject(e,1e3*u),g=SBRS.getMeasurePointObject(e,1e3*u+1e3*x),o=h.measure,r=h.point,f=1e3*u,i=g.measure,a=g.point,S=1e3*u+1e3*x;s[l++]=new t("boss_attack",o,r,f,i,a,S)}}return s}(),a=[-1,-1,-1],s=[-1,-1,-1],l=0,c=0,d=0,m=0,v=1;v<=e.measureCount||s[0]>=0||s[1]>=0||s[2]>=0;v+=4){var u=o.insertCell(-1),p="";p+='<table class="row" title="'+l+'">';for(var h=0;3>h;h++)a[h]=s[h],s[h]=-1;for(var g=0;4>g;g++){p+='<tr class="measure">',p+='<th><div style="width:20px;">'+(v+3-g)+"</div></th>",p+='<td class="lane"><div style="width:47px;">',p+=r;var f=v+3-g-1;if(f<e.measureCount)for(var S=e.measure[f],y=S.markerIndex;y<S.markerEndIndex;y++){var x=e.marker[y];switch(x.type){case 1:p+='<div class="marker1" style="bottom:'+(128*x.point-8)+"px; right:"+16*(3-x.lane)+"px; z-index:"+(v+3-g+10)+'"></div>',l++,checkAttackPlayer(i,x.time)?c++:d++;break;case 2:var b=4*(x["long"].measure-x.measure)+4*(x["long"].point-x.point),k=32*b,B=128*(g+1)-128*x.point,E=Math.ceil(b-(Math.ceil(4*x.point)-4*x.point))+2,R=!0;k>=B&&(s[x.lane-1]=k-B,k=B,R=!1),p+='<div class="marker3" style="bottom:'+128*x.point+"px; right:"+16*(3-x.lane)+"px; height:"+(k-3)+"px; z-index:"+(v+3-g+10)+'"></div>',p+='<div class="marker2" style="bottom:'+(128*x.point-8)+"px; right:"+16*(3-x.lane)+"px; z-index:"+(v+3-g+10)+'">'+E+"</div>",R&&(p+='<div class="marker2" style="bottom:'+(128*x.point-8+k)+"px; right:"+16*(3-x.lane)+"px; z-index:"+(v+3-g+10)+'"></div>'),l+=E,checkAttackPlayer(i,x["long"].marker[x["long"].longCount-1].time)?c+=E:d+=E}}for(var h=0;3>h;h++)if(3==g&&a[h]>=0){var k=a[h],B=512,R=!0;k>=B&&(s[h]=k-B,k=B,R=!1),k>0&&(p+='<div class="marker3" style="bottom:0px; right:'+16*(3-(h+1))+"px; height:"+(k-3)+"px; z-index:"+(v+3-g+10)+'"></div>'),R&&(p+='<div class="marker2" style="bottom:'+(k-8)+"px; right:"+16*(3-(h+1))+"px; z-index:"+(v+3-g+10)+'"></div>')}if(3==g)for(var w in i){var C=i[w].type,M=i[w].fromMeasure,z=i[w].fromPoint,T=i[w].toMeasure,I=i[w].toPoint;if(M>v+3)break;if(!(v>T)){var H=0,N=0,k=0;v>M?H=0:(H=(M-1)%4*128+128*z,m++),N=T>v+3?512:(T-1)%4*128+128*I,k=N-H-1,p+='<div class="'+C+'_board" style="bottom:'+H+"px; height:"+k+'px; z-index:1;"></div>'}}p+="</div></td>",p+="</tr>"}p+="</table>",u.innerHTML=p}document.getElementsByClassName("value")[4].innerHTML=m,document.getElementsByClassName("value")[5].innerHTML=c,document.getElementsByClassName("value")[6].innerHTML=d,l!==n.length&&console.error("combo error");var P=document.getElementsByClassName("value")[0].innerHTML;P=parseInt(P),l!==P&&console.error("combo error")}catch(L){console.error("譜面の描画に失敗しました");var O=document.createElement("tbody"),j=document.createElement("tr"),A=document.createElement("td");A.appendChild(document.createTextNode("このブラウザは未対応です。")),j.appendChild(A),O.appendChild(j),t.appendChild(O),document.getElementById("footer").style.display="none"}}SBRSScore=new function(){this.option=new Object,this.option.fiverHighRate=!1,this.option.stage="score",this.option.attackLong=!1,this.option.defenseShort=!1,this.option.measureOffset=2.5};